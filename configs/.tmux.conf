# ==============================================================================
# TMUX CONFIGURATION - Migrated from wezterm
# ==============================================================================

# ==============================================================================
# TERMINAL & SHELL SETTINGS
# ==============================================================================

# Use true color support
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",*256col*:Tc"

# Enable kitty keyboard protocol for better key handling (like wezterm)
set -g extended-keys on

# Set bash as default shell
set -g default-shell /bin/bash

# Enable mouse support
set -g mouse on

# Start window and pane numbering at 1
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Increase scrollback buffer
set -g history-limit 50000

# Faster command sequences
set -s escape-time 0

# Aggressive resize (useful for multi-monitor setups)
setw -g aggressive-resize on

# Allow automatic renaming of windows
setw -g automatic-rename on

# Display messages for 2 seconds
set -g display-time 2000

# ==============================================================================
# COLORS - Tokyo Night Theme
# ==============================================================================
# Note: For background image (/home/matt/thing/background.png) and font
# (Monocraft Bold 11pt with 1.4 line height), you need to configure your
# terminal emulator (e.g., alacritty, kitty, gnome-terminal, etc.)

# Tokyo Night colors
set -g status-style "bg=#1a1b26,fg=#c0caf5"
set -g pane-border-style "fg=#3b4261"
set -g pane-active-border-style "fg=#7aa2f7"
set -g window-status-current-style "bg=#7aa2f7,fg=#1a1b26,bold"
set -g window-status-style "bg=#1a1b26,fg=#c0caf5"
set -g message-style "bg=#7aa2f7,fg=#1a1b26"

# ==============================================================================
# KEYBINDINGS - Matching wezterm configuration
# ==============================================================================

# Reload tmux configuration: Ctrl+b r (equivalent to Ctrl+Shift+R in wezterm)
bind r source-file ~/.tmux.conf \; display "Configuration reloaded!"

# ==============================================================================
# PANE NAVIGATION - Alt+hjkl (matching wezterm)
# ==============================================================================

# Alt+hjkl for pane navigation (no prefix needed)
bind -n M-h select-pane -L
bind -n M-j select-pane -D
bind -n M-k select-pane -U
bind -n M-l select-pane -R

# ==============================================================================
# SMART SPLIT - Alt+q (matching wezterm)
# ==============================================================================

# Alt+q for smart split (vertical if wide, horizontal if narrow)
# Logic: if width > height * 2, split vertically (left/right), else horizontally (top/bottom)
# Using tmux built-in format comparison (more reliable than bc)
bind -n M-q if-shell -F "#{e|>:#{pane_width},#{e|*:#{pane_height},2}}" \
    'split-window -h -c "#{pane_current_path}"' \
    'split-window -v -c "#{pane_current_path}"'

# ==============================================================================
# PANE MANAGEMENT
# ==============================================================================

# Alt+w: Close current pane with confirmation (matching wezterm)
bind -n M-w confirm-before -p "Kill pane #P? (y/n)" kill-pane

# Alt+o: Toggle pane zoom (maximize/restore)
bind -n M-o resize-pane -Z

# Pane resizing with Alt+Arrow keys
bind -n M-Left resize-pane -L 5
bind -n M-Right resize-pane -R 5
bind -n M-Up resize-pane -U 5
bind -n M-Down resize-pane -D 5

# ==============================================================================
# SCROLLING - Ctrl+Shift+K/J (matching wezterm page up/down)
# ==============================================================================

# Ctrl+Shift+K: Scroll up by page
bind -n C-S-K copy-mode \; send-keys -X page-up

# Ctrl+Shift+J: Scroll down by page
bind -n C-S-J if-shell -F '#{pane_in_mode}' \
    'send-keys -X page-down' \
    'copy-mode \; send-keys -X page-down'

# ==============================================================================
# COPY MODE (VI STYLE)
# ==============================================================================

# Enable vi mode
set -g status-keys vi
setw -g mode-keys vi

# Vi-style copy mode bindings
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-selection-and-cancel
bind -T copy-mode-vi C-v send -X rectangle-toggle

# Ctrl+Shift+C: Copy selection to system clipboard
bind -T copy-mode-vi C-S-c send -X copy-pipe-and-cancel "xclip -selection clipboard -i"

# Mouse drag: automatically copy to clipboard when you release the mouse button
bind -T copy-mode-vi MouseDragEnd1Pane send -X copy-pipe-and-cancel "xclip -selection clipboard -i"

# Double-click to select word and copy
bind -T copy-mode-vi DoubleClick1Pane select-pane \; send -X select-word \; send -X copy-pipe-no-clear "xclip -selection clipboard -i"
bind -n DoubleClick1Pane select-pane \; copy-mode -M \; send -X select-word \; send -X copy-pipe-no-clear "xclip -selection clipboard -i"

# Triple-click to select line and copy
bind -T copy-mode-vi TripleClick1Pane select-pane \; send -X select-line \; send -X copy-pipe-no-clear "xclip -selection clipboard -i"
bind -n TripleClick1Pane select-pane \; copy-mode -M \; send -X select-line \; send -X copy-pipe-no-clear "xclip -selection clipboard -i"

# Exit copy mode with q or Escape
bind -T copy-mode-vi q send -X cancel
bind -T copy-mode-vi Escape send -X cancel

# ==============================================================================
# SHIFT+ENTER SUPPORT (for Claude Code line breaks)
# ==============================================================================

# Shift+Enter: Send a simple newline character for Claude Code
# Claude Code expects \n instead of complex escape sequences
bind -n S-Enter send-keys "\n"

# ==============================================================================
# STATUS BAR CONFIGURATION
# ==============================================================================

# Status bar position
set -g status-position top

# Status bar format (Tokyo Night themed)
set -g status-left "#[bg=#7aa2f7,fg=#1a1b26,bold] #S #[bg=#1a1b26,fg=#7aa2f7] "
set -g status-left-length 50
set -g status-right "#[bg=#3b4261,fg=#c0caf5] %Y-%m-%d #[bg=#7aa2f7,fg=#1a1b26,bold] %H:%M "
set -g status-justify left

# Window status format
setw -g window-status-format " #I:#W "
setw -g window-status-current-format " #I:#W "

# ==============================================================================
# WINDOW (TAB) MANAGEMENT
# ==============================================================================

# Alt+t: Create new window (tmux tab)
bind -n M-t new-window -c "#{pane_current_path}"

# Alt+x: Close current window with confirmation
bind -n M-x confirm-before -p "Kill window #W? (y/n)" kill-window

# Ctrl+Tab/Ctrl+Shift+Tab: Next/Previous window (may not work in all terminals)
bind -n C-Tab next-window
bind -n C-S-Tab previous-window

# Alt+n/Alt+p: Next/Previous window (fallback if Ctrl+Tab doesn't work)
bind -n M-n next-window
bind -n M-p previous-window

# Alt+r: Rename current window
bind -n M-r command-prompt -I "#W" "rename-window '%%'"

# Alt+1-9: Switch to window by number
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5
bind -n M-6 select-window -t 6
bind -n M-7 select-window -t 7
bind -n M-8 select-window -t 8
bind -n M-9 select-window -t 9

# ==============================================================================
# ADDITIONAL USEFUL BINDINGS
# ==============================================================================

# Prefix+| for vertical split, Prefix+- for horizontal split (traditional)
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# Prefix+c to create new window in current path
bind c new-window -c "#{pane_current_path}"

# ==============================================================================
# PLUGINS (TPM - Tmux Plugin Manager)
# ==============================================================================

# tmux-resurrect: Save and restore tmux sessions across reboots
# Keybindings:
#   Ctrl+b Ctrl+s - Save session
#   Ctrl+b Ctrl+r - Restore session
set -g @plugin 'tmux-plugins/tmux-resurrect'

# Initialize TPM (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
